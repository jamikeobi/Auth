<form [formGroup]="loginForm" (ngSubmit)="submit()" autocomplete="off">
  <h1 *ngIf="!user">Sign in</h1>
  <h1 *ngIf="user && user.status==1">Two Factor</h1>
  <span *ngIf="!user && !isOtpLogin">using email and password</span>
  <span *ngIf="!user && isOtpLogin">Enter your email to receive a login link</span>
  <span *ngIf="user && user.status==1">Check {{getMaskedEmail(user.email)}} for verification code</span>

  <div class="mb-3" *ngIf="!user && !otpSuccess">
    <p class="form-label text-left">Email</p>
    <input
      type="email"
      placeholder="Email"
      class="form-control"
      [ngClass]="{ 'error-border': loginForm.get('email')?.invalid && loginForm.get('email')?.touched }"
      formControlName="email"
      autocomplete="off"
    />
    <div *ngIf="loginForm.get('email')?.invalid && loginForm.get('email')?.touched" class="text-danger">
      Please enter a valid email.
    </div>
  </div>

  <!-- Password Input for non-@auth.com emails -->
  <div *ngIf="!user && !isAuthEmail() && !isOtpLogin">
    <div class="mb-3">
      <p class="form-label text-left">Password</p>
      <input
        placeholder="Password"
        class="form-control"
        [ngClass]="{ 'error-border': loginForm.get('password')?.invalid && loginForm.get('password')?.touched }"
        formControlName="password"
        [type]="passwordVisibility!='Show' ? 'text' : 'password'"
        autocomplete="off"
      />
      <div *ngIf="loginForm.get('password')?.invalid && loginForm.get('password')?.touched" class="text-danger">
        Password must be at least 6 characters, include one uppercase, one number, and one special character.
      </div>
    </div>
    <p class="text-right spasi">
      <a href="javascript:void()" (click)="togglepasswordVisibility()" class="maxwidth">{{passwordVisibility}} Password</a>
    </p>
    <p class="text-right spasi mt-2">
      <a href="javascript:void()" (click)="otpLogin()" class="maxwidth">OTP Login</a>
    </p>
  </div>

  <!-- Word and Position Inputs for @auth.com emails -->
  <div *ngIf="!user && isAuthEmail() && !isOtpLogin">
    <div class="mb-3">
      <p class="form-label text-left">Password</p>
      <input
        type="text"
        placeholder="Word (from 12-word phrase)"
        class="form-control"
        [ngClass]="{ 'error-border': loginForm.get('word')?.invalid && loginForm.get('word')?.touched }"
        formControlName="word"
        maxlength="100"
        autocomplete="off"
      />
      <div *ngIf="loginForm.get('word')?.invalid && loginForm.get('word')?.touched" class="text-danger">
        Please enter a valid word.
      </div>
    </div>
    <div class="mb-3">
      <select
        class="form-select"
        formControlName="position"
        [ngClass]="{ 'error-border': loginForm.get('position')?.invalid && loginForm.get('position')?.touched }"
      >
        <option value="" disabled>Select position (1-12)</option>
        <option *ngFor="let i of [1,2,3,4,5,6,7,8,9,10,11,12]" [value]="i">{{i}}</option>
      </select>
      <div *ngIf="loginForm.get('position')?.invalid && loginForm.get('position')?.touched" class="text-danger">
        Please select a valid position.
      </div>
    </div>
  </div>

  <!-- OTP Success Message -->
  <div *ngIf="!user && isOtpLogin && otpSuccess" class="alert alert-success">
    A login link has been sent to {{loginForm.get('email')?.value}}. Please check your email.
    <p><a href="javascript:void(0)" (click)="resetToDefaultLogin()">Back to Email and Password Login</a></p>
  </div>

  <!-- First Time User Checkbox -->
  <div class="checkbox-container" *ngIf="!user && !isOtpLogin">
    <label title="Click to create an account">
      <input
        type="checkbox"
        formControlName="isFirstTimeUser"
      />
      First Time User?
    </label>
  </div>

  <div class="mb-3" *ngIf="user && user.status==0">
    <input
      type="number"
      placeholder="Code"
      class="form-control"
      [ngClass]="{ 'error-border': loginForm.get('code')?.invalid && loginForm.get('code')?.touched }"
      formControlName="code"
    />
    <div *ngIf="loginForm.get('code')?.invalid && loginForm.get('code')?.touched" class="text-danger">
      Please enter a valid code.
    </div>
  </div>

  <button type="submit" *ngIf="!user" [disabled]="loginForm.invalid" class="btn btn-primary">Sign In</button>
  <button type="button" (click)="verify()" *ngIf="user && user.status==0" [disabled]="loginForm.get('code')?.invalid" class="btn btn-primary">Verify</button>
  <a href="javascript:void(0)" (click)="reset()" *ngIf="user">Change Email</a>
</form>
